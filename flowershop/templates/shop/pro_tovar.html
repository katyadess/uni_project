{% extends "shop/base.html" %}
{% block css_links %}
{% load static %}
<link rel="stylesheet" href="{% static "shop/css/pro_tovar.css" %}">
{% endblock css_links %}

{% block logo_img %}
<img src="{% static "shop/images/pinkVector.png" %}" alt="і" class="icon">ти
{% endblock logo_img %}

{% block content %}
    <main class="product-page-container">
        <a href="{% url "shop:main" %}" class="nav-link" id="back-arrow-button">
            <i class="bi bi-arrow-left"></i> Повернутися на головну
        </a> 
        <section class="product-details-section">
            <div class="product-layout">
                <div class="product-image-container">
                    <img src="{{ bouquet.image.url }}" alt="{{ bouquet.name }}"> </div>
                <div class="product-info-container">
                    <h1 class="product-title">Букет {{ bouquet.name }}</h1>
                    <div class="product-price">
                        {% if bouquet.new_price %}
                            <span class="old-price">{{ bouquet.price|floatformat:0 }} грн</span>
                            <span class="new-price">{{ bouquet.new_price|floatformat:0 }} грн</span>
                            <span class="discount-badge">-{{ bouquet.discount|floatformat:0 }}%</span>
                        {% else %}
                            <span class="new-price">{{ bouquet.price|floatformat:0 }} грн</span>
                        {% endif %}
                    </div>



                    {% comment %} form {% endcomment %}
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="bouquet_id" value="{{ bouquet.id }}">
                        <input type="number" name="quantity" min="1" value="1" class="quantity-input" style='display:none'>
                        <button class="order-button" type='submit' name='add-to-cart'>Замовити</button>
                    </form>

                    <p class="product-composition">
                        <strong>Склад:</strong> {{bouquet.composition}}
                    </p>
                    <p class="product-guarantee">
                        <strong>Гарантія якості:</strong> квіти простоять не менш ніж 5 днів, в іншому випадку ми їх замінимо
                    </p>

                    <div class="tabs-container">
                        <div class="tabs-nav">
                            <button class="tab-link active" data-tab="description">Опис</button>
                            <button class="tab-link" data-tab="delivery">Доставка</button>
                        </div>
                        <div class="tabs-content">
                            <div id="description" class="tab-pane active">
                                <p>{{bouquet.description}}</p>
                            </div>
                            <div id="delivery" class="tab-pane">
                                <ul>
                                    <li>Cтандартна (~2 години) — <strong>безкоштовно</strong></li>    
                                    <li>Експрес (через 30 хвилин) — <strong>99 грн</strong></li>   
                                    <li>В точний час — <strong>99 грн</strong></li>
                                    <li>Самовивіз — <strong>безкоштовно</strong></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="product-reviews">
            <h2 class="reviews-title">Відгуки про товар</h2>
            <div class="reviews-list">
                {% for review in reviews %}
                    <div class="review-item">
                        <div class="review-header">
                            <span class="review-author">{{review.user.first_name}}</span>
                            <span class="review-date">{{ review.created_at|date:"d.m.Y" }}</span>
                        </div>
                        <p class="review-body">{{review.text}}</p>
                    </div>
                {% empty %}
                    <p>Поки що немає відгуків. Будьте першим!</p>
                {% endfor %}
            </div>
            
            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}" class="pagination-button">← Назад</a>
                {% endif %}

                <span class="current-page">Сторінка {{ page_obj.number }} з {{ page_obj.paginator.num_pages }}</span>

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="pagination-button">Далі →</a>
                {% endif %}
            </div>
            
        </section>

        <section class="add-review-section">
            <h3 class="add-review-title">Купляли цей товар? Залишіть відгук</h3>
            {% if user.is_authenticated %}
                <form class="review-form" method="POST" action="{% url "shop:pro_tovar" bouquet.id %}">
                    {% csrf_token %}
                    {{ review_form.text }}
                    <button type="submit" class="submit-review-button" name="send-review">Надіслати</button>
                </form>
            {% else %}
                <p>Щоб залишити відгук, <a href="{% url 'shop:home' %}">увійдіть у свій акаунт</a>.</p>
            {% endif %}
        </section>

    </main>
{% endblock content %}

{% block scripts %}
<script src="{% static "shop/js/pro_tovar.js" %}"></script>
{% endblock scripts %} 